function LoadHoSo(){var n=$('input[name="hdfHoSoId"]').val(),t,i,r;n==""&&(n=0,$('input[name="hdfHoSoId"]').val(0),t=$(".btn_Xoa_Ho_So"),t.parent().addClass("hidden"),i=$(".btn_In_Bien_Nhan"),i.parent().addClass("hidden"));n!=0?(t=$(".btn_Xoa_Ho_So"),t.parent().removeClass("hidden"),i=$(".btn_In_Bien_Nhan"),i.parent().removeClass("hidden"),r=JSON.stringify({hosoId:n}),window.AjaxDungChung("post","/DesktopModules/MVC/NghiepVu/MotCua/GetHoSoById",window.moduleId,window.tabId,$("input[name='__RequestVerificationToken']").val(),r,"application/json; charset=utf-8","json",!0).then(function(n){if(n){isFirstLoad=!0;var t=$.parseJSON(n.Content);t?(loadLinhVuc(t.LinhVucID),$('input[name="hdfSoBienNhan"]').val(t.SoBienNhan),$('input[name="hdfTrangThaiHoSoID"]').val(t.TrangThaiHoSoID),$('input[name = "SoBienNhan"]').val(t.SoBienNhan),loadThuTuc(t.LinhVucID,t.ThuTucID),loadThongTinHoSo(t.ThuTucID),t.NgayNhan&&$('input[name ="NgayNhan"]').data("DateTimePicker").date(new Date(t.NgayNhan.match(/\d+/)[0]*1)),t.NgayHenTra&&$('input[name="NgayHenTra"]').data("DateTimePicker").date(new Date(t.NgayHenTra.match(/\d+/)[0]*1)),$('input[name = "LePhi"]').val(t.LePhi),$('input[name = "HoTenNguoiNop"]').val(t.HoTenNguoiNop),$("input[name=GioiTinh][value='"+t.GioiTinhID+"']").prop("checked",!0),$("input[name=LoaiGiayTo][value='"+t.LoaiGiayToID+"']").prop("checked",!0),$('input[name = "SoGiayTo"]').val(t.SoGiayTo),$('input[name = "NoiCap"]').val(t.NoiCapGiayTo),$('input[name ="NgaySinh"]').val(t.NgaySinh),t.NgayCapGiayTo&&$('input[name="NgayCap"]').data("DateTimePicker").date(new Date(t.NgayCapGiayTo.match(/\d+/)[0]*1)),$('input[name = "ThuongTruSoNha"]').val(t.SoNha),$('input[name = "HienNaySoNha"]').val(t.HienNaySoNha),loadTinhThanh(t.TinhThanhID,t.HienNayTinhThanhID),loadThuongTruHuyen(t.TinhThanhID,t.QuanHuyenID),loadHienNayHuyen(t.HienNayTinhThanhID,t.HienNayQuanHuyenID),loadThuongTruPhuong(t.QuanHuyenID,t.PhuongXaID),loadHienNayPhuong(t.HienNayQuanHuyenID,t.HienNayPhuongXaID),$('input[name = "DienThoai"]').val(t.Phone),$('input[name = "Email"]').val(t.Email),getChungTuKemTheo(t.HoSoID),loadTrinhDo(t.TrinhDoChuyenMonID),loadHinhThucToChuc(t.HinhThucToChucID),loadNoiNhanKetQua(t.NoiNhanKetQuaID),$('textarea[name = "GhiChu"]').val(t.GhiChu)):setNewForm();isFirstLoad=!1}})):setNewForm()}function InitControl(){var n,t,i,r;$(".adselect").select2();window.InitFromToDatePicker(".date-picker-from",".date-picker-to");window.InitNgaySinhNgayCapGiayToDatePickerAndString(".date-picker-ngay-sinh",".date-picker-ngay-cap");n=$(".rd_gioi_tinh");t=html_gen_radio(data_Gioi_Tinh,"GioiTinh");n.empty().append(t);i=$(".rd_loai_giay_to");r=html_gen_radio(data_LoaiGiayTo,"LoaiGiayTo");i.empty().append(r)}function html_gen_radio(n,t){var i="";return $.each(n,(n,r)=>{i+='<input type="radio" name="'+t+'" value="'+r.ID+'" ><span class="sknadTitle-gray-normal font-size-13"> '+r.Ten+" <\/span>&nbsp;"}),i}function setNewForm(){$('input[name="hdfTrangThaiHoSoID"]').val(1);loadLinhVuc();$('input[name = "SoBienNhan"]').val("");window.LoadSelect2($(".sl_thu_tuc_ho_so_index"),[],null,!0);$('input[name = "SoNgayGiaiQuyet"]').val(0);$('input[name = "NgayNhan"]').data("DateTimePicker").date(new Date);$('input[name="NgayHenTra"]').data("DateTimePicker").date(new Date);$('input[name = "TuDong"]').prop("checked",!0);loadTinhThanh();window.LoadSelect2($(".sl_thuong_tru_huyen_index"),[],null,!0);window.LoadSelect2($(".sl_thuong_tru_phuong_index"),[],null,!0);window.LoadSelect2($(".sl_hien_nay_huyen_index"),[],null,!0);window.LoadSelect2($(".sl_hien_nay_phuong_index"),[],null,!0);$('input[name = "HoTenNguoiNop"]').val("");$("input[name=GioiTinh]:first").prop("checked",!0);$("input[name=LoaiGiayTo]:first").prop("checked",!0);$('input[name = "SoGiayTo"]').val("");$('input[name = "NoiCap"]').val("");$('input[name ="NgaySinh"]').val("");$('input[name="NgayCap"]').data("DateTimePicker").date(null);$('input[name = "ThuongTruSoNha"]').val("");$('input[name = "HienNaySoNha"]').val("");$('input[name = "DienThoai"]').val("");$('input[name = "Email"]').val("");getChungTuKemTheo();loadTrinhDo();loadHinhThucToChuc();loadNoiNhanKetQua();$("input[name=NoiNhanKetQua]:first").prop("checked",!0);$('textarea[name = "GhiChu"]').val("")}function checkForm(){var n=!0;return $(".sl_linh_vuc_ho_so_index").val()==""||$(".sl_linh_vuc_ho_so_index").val()=="--//--"?(window.appendValidate($(".sl_linh_vuc_ho_so_index"),"border-color-a9",".color-red","<label class='color-red'>Vui lòng chọn lĩnh vực<\/label>"),n=!1):window.removeValidate($(".sl_linh_vuc_ho_so_index"),"border-color-a9",".color-red"),$(".sl_thu_tuc_ho_so_index").val()==""||$(".sl_thu_tuc_ho_so_index").val()=="--//--"?(window.appendValidate($(".sl_thu_tuc_ho_so_index"),"border-color-a9",".color-red","<label class='color-red'>Vui lòng chọn thủ tục<\/label>"),n=!1):window.removeValidate($(".sl_thu_tuc_ho_so_index"),"border-color-a9",".color-red"),window.ValidateRequireOnDiv(".div_them_ho_so")||(n=!1),$('input[name = "Email"]').val()==""||window.ValidateEmailOnDiv(".div-email")||(n=!1),n}function convertDataURItoFile(n,t){for(var r,u=atob(n.split(",")[1]),e=n.split(",")[0].split(":")[1].split(";")[0],o=new ArrayBuffer(u.length),f=new Uint8Array(o),i=0;i<u.length;i++)f[i]=u.charCodeAt(i);return r=new Blob([f],{type:e}),r.lastModifiedDate=new Date,r.name=t,r}var _fileTypesImg=["jpg","jpeg","png","tiff","gif"],_fileTypesDinhKem=["doc","docx","xls","xlsx","pdf","jpg","jpeg","png","tiff","gif","sig","enc"],_formDataDinhKem=new FormData,_arrHoSoDinhKem=[],_valid_image=!1,data_Gioi_Tinh=[{ID:1,Ten:" Nam"},{ID:2,Ten:" Nữ"},{ID:3,Ten:" Không xác định"}],data_LoaiGiayTo=[{ID:1,Ten:" Chứng minh nhân dân"},{ID:2,Ten:" Hộ chiếu"},{ID:3,Ten:" Căn cước công dân"},{ID:4,Ten:" Khác"}],isFirstLoad=!1;$(document).ready(()=>{InitControl(),LoadHoSo()});$(".btn_Luu").click(()=>{var i,u;if(checkForm()){var n=window.GetAllInputOnDiv(".div_them_ho_so"),t=new FormData,r=$('input[name = "hdfHoSoId"]').val();n.HoSoID=r!=""?r:0;t.append("hoso",JSON.stringify(n));i=[];u=$(".div_ho_so_kem_theo table tbody").children("tr");$.each(u,(r,u)=>{var f=$(u).attr("data-id"),e=_arrHoSoDinhKem.filter(n=>n.ID==f),o={TenChungTu:n["ten_chung_tu_"+f],SLBanChinh:n["so_ban_chinh_"+f]?n["so_ban_chinh_"+f]:0,SLBanSao:n["so_ban_sao_"+f]?n["so_ban_sao_"+f]:0,SLBanPhoTo:n["so_ban_photo_"+f]?n["so_ban_photo_"+f]:0,GhiChu:n["ghi_chu_"+f],AttachFile:e&&e[0]!=undefined?e[0].AttachFile:"",DinhKemID:f};o.TenChungTu!=""&&(i.push(o),t.append(f,$('input[name="'+f+'"]')[0].files[0]))});t.append("chungtukemtheo",JSON.stringify(i));window.AjaxDungChung("post","/DesktopModules/MVC/NghiepVu/MotCua/SaveHoSo",window.moduleId,window.tabId,$("input[name='__RequestVerificationToken']").val(),t,!1,"json",!1).then(n=>{var t,r,i;if(n)if($('input[name="hdfHoSoId"]').val()==0){if(t=n,t==-1){window.alert_error("Lưu không thành công!");return}r=$(".btn_Tro_Ve");i=$(".btn_Tro_Ve").attr("data-prev");window.alert_success("Lưu thành công!");setTimeout(()=>{location.href=window.location.origin+"?TabID="+window.tabId+"&hoSoID="+t+(i?"&prev="+i:"")},1e3)}else{if(n<=0){window.alert_error("Lưu không thành công!");return}window.alert_success("Lưu thành công!");LoadHoSo()}else window.alert_error("Lưu không thành công!")})}});$(".btn_Tro_Ve").click(n=>{var i=$(n.target),t=i.attr("data-prev");t?(t=t.replace(/_/g,"/"),window.location.href=(t.indexOf("/")<0?"/":"")+t):window.AjaxDungChung("post","/DesktopModules/MVC/NghiepVu/HoSo/GetModule",window.moduleId,window.tabId,$("input[name='__RequestVerificationToken']").val(),JSON.stringify({module:"NV.HoSo.Module"}),"application/json; charset=utf-8","json",!0).then(function(n){if(n){var i=window.location.pathname,t=n.TabID;location.href=t}})});$(".btn_Them_Moi").click(()=>{location.href=window.location.origin+"?TabID="+window.tabId});$(".btn_Xoa_Ho_So").click(()=>{var n=$('input[name = "hdfHoSoId"]').val(),t;n&&n!=0?(t=JSON.stringify({hosoId:n,trangThaiHoSoID:$('input[name="hdfTrangThaiHoSoID"]').val()}),window.AjaxDungChung("post","/DesktopModules/MVC/NghiepVu/MotCua/XoaHoSoByHoSoID",window.moduleId,window.tabId,$("input[name='__RequestVerificationToken']").val(),t,"application/json; charset=utf-8","json",!0).then(function(n){n&&n.Content=="true"?$(".btn_Tro_Ve").trigger("click"):window.alert_error("Xóa không thành công!")})):setNewForm()});$(".btn_In_Bien_Nhan").click(()=>{var n=$('input[name = "hdfHoSoId"]').val(),t;n&&n!=0&&(t=JSON.stringify({hosoId:n}),window.AjaxDungChung("post","/DesktopModules/MVC/NghiepVu/MotCua/InBienNhan",window.moduleId,window.tabId,$("input[name='__RequestVerificationToken']").val(),t,"application/json; charset=utf-8","json",!0).then(function(n){var t;if(n){var r=convertDataURItoFile("data:application/vnd.ms-word;base64,"+n.Data,n.FileName),u=window.URL||window.webkitURL,i=u.createObjectURL(r);n.FileName?(t=document.createElement("a"),typeof t.download=="undefined"?window.location=i:(t.href=i,t.download=n.FileName,document.body.appendChild(t),t.click(),document.body.removeChild(t))):window.location=i}}))});$('input[name = "SoBienNhan"]').blur(()=>{var n=$('input[name = "SoBienNhan"]').val(),t;n&&$('input[name="hdfSoBienNhan"]').val()!=n&&(t=JSON.stringify({SoBienNhan:n}),window.AjaxDungChung("post","/DesktopModules/MVC/NghiepVu/MotCua/MotCua_KiemTraSoBienNhan",window.moduleId,window.tabId,$("input[name='__RequestVerificationToken']").val(),t,"application/json; charset=utf-8","json",!0).then(function(n){n||($('input[name = "TuDong"]').is(":checked")?(window.alert_error("Số biên nhận đã tồn tại!<br>Hệ thống tự động tạo số mới"),GenSoBienNhan($(".sl_thu_tuc_ho_so_index").val())):window.alert_error("Số biên nhận đã tồn tại!"))}))});