function searchThuTuc(){var n=$("#inputsearchThuTucDM_ThuTucScr").val();drawTableThuTuc(n)}function drawTableThuTuc(n){var t=$("#tbldmthutuc").DataTable({proccessing:!0,serverSide:!0,destroy:!0,ajax:{type:"POST",url:"/DesktopModules/MVC/DanhMuc/DMLoaiHoSo/DM_ThuTucList",dataType:"json",data:{tuKhoa:n},headers:{ModuleId:moduleId,TabId:tabId,RequestVerificationToken:rvtoken}},dom:"<'row'<'col-md-8 col-sm-10' <'col-lg-3 col-md-3 col-sm-6  text-left  font-size-13 mt-mobile-5'i><'col-lg-3 col-md-4 col-sm-6  text-left nopadding  font-size-13 mt-mobile-5'l><'col-lg-1 col-md-1 col-sm-2 font-size-13  mt-mobile-5 col-xs-2 text-center padding-all-5'> <'col-lg-5 col-md-4 col-sm-10  col-xs-10 nopadding text-left no-border decrease-padding  font-size-13 syt-label mt-mobile-5'p>><'col-md-4 col-sm-2'>><t>",language:{lengthMenu:"_MENU_ &nbsp;dòng trên trang",zeroRecords:"Không có dữ liệu",info:"Tổng số dòng:&nbsp;  _TOTAL_",infoEmpty:"STT 0 - 0 / 0",paginate:{first:"|<",previous:"",next:"",last:">|"},search:"Tìm Kiếm"},columns:[{data:"RowNo",className:"text-center font-size-13"},{data:"TenLinhVuc",className:"text-left font-size-13"},{data:"MaThuTuc",className:"text-left font-size-13"},{data:"TenThuTuc",className:"text-left font-size-13"},{data:"SoNgayGiaiQuyet",className:"text-left font-size-13"},{data:"ThoiGianNhacDenHan",className:"text-left font-size-13"},{data:"LePhi",className:"text-left font-size-13"},{data:"Used",render:function(n,t){return t==="display"?'<input type="checkbox" '+(n==!0?"checked":"")+"/>":n},className:"text-center"},{render:function(n,t,i){return'<a href="#" onclick="existThuTuc('+i.ThuTucID+')"><img src="images/u3427.png"><\/a>'}}],lengthChange:!0,ordering:!1,searching:!1,autoWidth:!1,responsive:!0});window.ReLoadAjaxDataTable(t)}function showhideDivupdThuTuc(){$("#right_linhvuc").hide();$("#right_thutuc").hide();$("#right_quytrinhthutuc").hide();$("#right_tinhthanh").hide();$("#right_huyenthi").hide();$("#right_phuongxa").hide();$("#right_noicapphep").hide();$("#right_trinhdochuyenmon").hide();$("#right_vitrichuyenmon").hide();$("#right_phamvihanhngheduoc").hide();$("#right_phamvihoatdongKCB").hide();$("#right_phamvikinhdoanhthuoc").hide();$("#right_dangsanphammypham").hide();$("#right_hinhthuctochuc").hide();$("#right_dieukienhanhnghe").hide();$("#right_loaibaocao").hide();$("#right_lydo").hide();$("#right_gopy").hide();$("#right_themlinhvuc").hide();$("#right_themquytrinh").hide();$("#right_themthutuc").show()}function showhideDivThuTuc(){$("#right_linhvuc").hide();$("#right_thutuc").show();$("#right_quytrinhthutuc").hide();$("#right_tinhthanh").hide();$("#right_huyenthi").hide();$("#right_phuongxa").hide();$("#right_noicapphep").hide();$("#right_trinhdochuyenmon").hide();$("#right_vitrichuyenmon").hide();$("#right_phamvihanhngheduoc").hide();$("#right_phamvihoatdongKCB").hide();$("#right_phamvikinhdoanhthuoc").hide();$("#right_dangsanphammypham").hide();$("#right_hinhthuctochuc").hide();$("#right_dieukienhanhnghe").hide();$("#right_loaibaocao").hide();$("#right_lydo").hide();$("#right_gopy").hide();$("#right_themlinhvuc").hide();$("#right_themquytrinh").hide();$("#right_themthutuc").hide()}function backtoDSThuTuc(){$("#right_linhvuc").hide();$("#right_thutuc").show();$("#right_quytrinhthutuc").hide();$("#right_tinhthanh").hide();$("#right_huyenthi").hide();$("#right_phuongxa").hide();$("#right_noicapphep").hide();$("#right_trinhdochuyenmon").hide();$("#right_vitrichuyenmon").hide();$("#right_phamvihanhngheduoc").hide();$("#right_phamvihoatdongKCB").hide();$("#right_phamvikinhdoanhthuoc").hide();$("#right_dangsanphammypham").hide();$("#right_hinhthuctochuc").hide();$("#right_dieukienhanhnghe").hide();$("#right_loaibaocao").hide();$("#right_lydo").hide();$("#right_gopy").hide();$("#right_themlinhvuc").hide();$("#right_themquytrinh").hide();$("#right_themthutuc").hide()}function newThuTuc(){showhideDivupdThuTuc();$("#inputMaThuTucDM_ThuTucScr").val("");$("#inputTenThuTucDM_ThuTucScr").val("");loadLinhVuc_DM_ThuTucScreen();loadLoaiCapPhep_DM_ThuTucScr();$("#inputThoiGianGQThuTucDM_ThuTucScr").val("");$("#inputThoiGianNhacThuTucDM_ThuTucScr").val("");$("#inputLePhiDM_ThuTucScr").val("");$("#inputUsedDM_ThuTucScr").prop("checked",!1);$(".div_ho_so_kem_theo table tbody").html("")}function saveThuTuc(){var r,n,t,i,u;if($("#inputMaThuTucDM_ThuTucScr").val()==""){window.alert_error("Vui lòng nhập Mã thủ tục!");$("#inputMaThuTuc").focus();return}if($("#inputTenThuTucDM_ThuTucScr").val()==""){window.alert_error("Vui lòng nhập Tên thủ tục!");$("#inputTenThuTuc").focus();return}if(r=$(".sl_thuoclinhvucDM_ThuTucScr option:selected").val(),r=="--//--"){window.alert_error("Vui lòng chọn lĩnh vực!");return}if($("#inputThoiGianGQThuTucDM_ThuTucScr").val()==""){window.alert_error("Vui lòng nhập Thời gian giải quyết!");$("#inputThoiGianGQThuTuc").focus();return}if($("#inputThoiGianGQThuTucDM_ThuTucScr").val()<=0){window.alert_error("Vui lòng nhập Thời gian giải quyết hợp lệ!");$("#inputThoiGianGQThuTuc").focus();return}n={};n.LinhVucID=$(".sl_thuoclinhvucDM_ThuTucScr option:selected").val();n.TenLinhVuc=$("#inputTenLinhVucDM_ThuTucScr").val();n.MaThuTuc=$("#inputMaThuTucDM_ThuTucScr").val();n.TenThuTuc=$("#inputTenThuTucDM_ThuTucScr").val();n.SoNgayGiaiQuyet=$("#inputThoiGianGQThuTucDM_ThuTucScr").val();n.ThoiGianNhacDenHan=$("#inputThoiGianNhacThuTucDM_ThuTucScr").val();n.LoaiCapPhepID=$(".sl_loaicapphepDM_ThuTucScr option:selected").val();n.LePhi=$("#inputLePhiDM_ThuTucScr").val();n.Used=$("#inputUsedDM_ThuTucScr").prop("checked");t=new FormData;t.append("model",JSON.stringify(n));i=[];u=$(".div_ho_so_kem_theo table tbody").children("tr");$.each(u,(t,r)=>{var u=$(r).attr("data-id"),e=_arrHoSoDinhKem.filter(n=>n.ID==u),f;n["ten_chung_tu_"+u]=$("input[name='ten_chung_tu_"+u+"']").val();n["so_ban_chinh_"+u]=$("input[name='so_ban_chinh_"+u+"']").val();n["so_ban_sao_"+u]=$("input[name='so_ban_sao_"+u+"']").val();n["so_ban_photo_"+u]=$("input[name='so_ban_photo_"+u+"']").val();f={TenChungTu:n["ten_chung_tu_"+u],SLBanChinh:n["so_ban_chinh_"+u]?n["so_ban_chinh_"+u]:0,SLBanSao:n["so_ban_sao_"+u]?n["so_ban_sao_"+u]:0,SLPhoTo:n["so_ban_photo_"+u]?n["so_ban_photo_"+u]:0};f.TenChungTu!=""&&i.push(f)});t.append("chungtukemtheo",JSON.stringify(i));window.AjaxDungChung("post","/DesktopModules/MVC/DanhMuc/DMLoaiHoSo/SaveDMThuTuc",window.moduleId,window.tabId,$("input[name='__RequestVerificationToken']").val(),t,!1,"json",!1).then(n=>{n?(window.alert_success("Lưu thành công!"),backtoDSThuTuc(),drawTableThuTuc("")):window.alert_success("Lưu chưa thành công!")})}function existThuTuc(n){showhideDivupdThuTuc();loadLinhVuc_DM_ThuTucScreen();loadLoaiCapPhep_DM_ThuTucScr();var t=JSON.stringify({ThuTucID:n});window.AjaxDungChung("post","/DesktopModules/MVC/DanhMuc/DMLoaiHoSo/GetThuTucByThuTucID",window.moduleId,window.tabId,$("input[name='__RequestVerificationToken']").val(),t,"application/json; charset=utf-8","json",!0).then(function(n){if(n){var t=$.parseJSON(n.Content);$("#inputMaThuTucDM_ThuTucScr").val(t.MaThuTuc);$("#inputTenThuTucDM_ThuTucScr").val(t.TenThuTuc);setTimeout(function(){$(".sl_thuoclinhvucDM_ThuTucScr").val(t.LinhVucID).trigger("change.select2")},500);setTimeout(function(){$(".sl_loaicapphepDM_ThuTucScr").val(t.LoaiCapPhepID).trigger("change.select2")},500);$("#inputThoiGianGQThuTucDM_ThuTucScr").val(t.SoNgayGiaiQuyet);$("#inputThoiGianNhacThuTucDM_ThuTucScr").val(t.ThoiGianNhacDenHan);$("#inputLePhiDM_ThuTucScr").val(t.LePhi);$("#inputUsedDM_ThuTucScr").prop("checked",t.Used);setTimeout(function(){getChungTuKemTheo(t.ThuTucID)},300)}})}function html_gen_new_kem_theo(n){var t="";return t+=' <tr class="font-size-13" name="tr-edit" data-id="'+n.ID+'">',t+='    <td name="stt_'+n.ID+'"><\/td>',t+="    <td>",t+='   <input name="ten_chung_tu_'+n.ID+'" class="width-100 syt-radius-3 min-h-30 paddingMin" min="0" value="'+n.TenChungTu+'" type="text" />',t+="   <\/td>",t+="    <td>",t+='   <input name="so_ban_chinh_'+n.ID+'" class="width-100 syt-radius-3 min-h-30 paddingMin" min="0" value="'+n.SLBanChinh+'" type="number" onfocus="onfocusNumber(event)" />',t+="   <\/td>",t+="    <td>",t+='   <input name="so_ban_sao_'+n.ID+'" class="width-100 syt-radius-3 min-h-30 paddingMin" min="0" value="'+n.SLBanSao+'" type="number" onfocus="onfocusNumber(event)" />',t+="   <\/td>",t+="    <td>",t+='   <input name="so_ban_photo_'+n.ID+'" class="width-100 syt-radius-3 min-h-30 paddingMin" min="0" value="'+n.SLPhoto+'" type="number" onfocus="onfocusNumber(event)" />',t+="   <\/td>",t+='   <td class="text-center" title="Xóa">',t+='    <div class="show-inline cursor-pointer min-h-30 mt-mobile-5">',t+=' <span type="button" title="Hủy" onclick="fn_cancel_edit(this)" ',t+=' class="glyphicon glyphicon-remove syt-icon-cancel"><\/span>',t+="   <\/div>",t+="   <\/td>",t+"  <\/tr>"}function onfocusNumber(n){$(n.target).select()}function fn_cancel_edit(n){var t=$(n),i=t.closest("tr");i.remove();reset_stt_kem_theo()}function reset_stt_kem_theo(){var n=$(".div_ho_so_kem_theo table tbody").children("tr");$.each(n,(n,t)=>{var r=$(t).attr("data-id"),i=$(t).find('td[name="stt_'+r+'"]');i.empty();i.append(n+1)})}function loadLinhVuc_DM_ThuTucScreen(){window.AjaxDungChung("post","/DesktopModules/MVC/DanhMuc/DMLoaiHoSo/GetDanhMucLinhVuc",window.moduleId,window.tabId,$("input[name='__RequestVerificationToken']").val(),null,"application/json; charset=utf-8","json",!0).then(function(n){if(n){var t=[];$.each(n,(n,i)=>{t.push({ID:i.LinhVucID,Ten:i.TenLinhVuc})});window.LoadSelect2($(".sl_thuoclinhvucDM_ThuTucScr"),t,null,!0)}})}function loadLoaiCapPhep_DM_ThuTucScr(){window.AjaxDungChung("post","/DesktopModules/MVC/DanhMuc/DMLoaiHoSo/GetLoaiCapPhep",window.moduleId,window.tabId,$("input[name='__RequestVerificationToken']").val(),null,"application/json; charset=utf-8","json",!0).then(function(n){n&&(data_LoaiCapPhep=[],$.each(n,(n,t)=>{data_LoaiCapPhep.push({ID:t.LoaiCapPhepID,Ten:t.Ten})}),window.LoadSelect2($(".sl_loaicapphepDM_ThuTucScr"),data_LoaiCapPhep,null,!0))})}function getChungTuKemTheo(n){var t,i;n?(t=JSON.stringify({thuTucID:n}),window.AjaxDungChung("post","/DesktopModules/MVC/DanhMuc/DMLoaiHoSo/GetDMChungTuKemTheoByThuTucID",window.moduleId,window.tabId,$("input[name='__RequestVerificationToken']").val(),t,"application/json; charset=utf-8","json",!0).then(n=>{if(n){var t=$.parseJSON(n.Content),i=$(".div_ho_so_kem_theo table tbody");i.html("");$.each(t,(n,t)=>{var i={ID:window.newGUIDFunc(),TenChungTu:t.TenChungTu,SLBanChinh:t.SLBanChinh,SLBanSao:t.SLBanSao,SLPhoto:t.SLPhoto};$(".div_ho_so_kem_theo table tbody").append(html_gen_new_kem_theo(i))});reset_stt_kem_theo()}})):(i=$(".div_ho_so_kem_theo table tbody"),i.html(""))}var _arrHoSoDinhKem=[];$("#thutuc").click(function(){showhideDivThuTuc();setTimeout(function(){drawTableThuTuc("")},300)});$(document).on("click",".a_them_moi_kem_theo_index",()=>{var n={ID:window.newGUIDFunc(),TenChungTu:"",SLBanChinh:0,SLBanSao:0,SLPhoto:0};$(".div_ho_so_kem_theo table tbody").append(html_gen_new_kem_theo(n));reset_stt_kem_theo()});